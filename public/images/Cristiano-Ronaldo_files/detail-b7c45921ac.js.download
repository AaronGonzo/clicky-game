"use strict";var _extends=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}return t};!function(t,e,r,n){function a(e){if("GK"!==window.fhContext.player.position){e===n&&(e=t("body"));var r=t(e),a={},i={};t.each(r.find(".player-stat-row"),function(e,r){r=t(r),a[r.find(".chembot-delta").data("chembotField")]=parseInt(r.find(".chembot-value").text())}),window.ut.player.getRatingPerPositionForYear(window.fhContext.year).then(function(e){t.each(e,function(t,e){var r=0;Object.keys(e).forEach(function(t){r+=e[t]*a[t]}),i[t]=Math.round(r)}),t.each(i,function(t,e){var n=r.find(".igr-"+t+"-value").removeClassByPattern("(default|stat-color-\\d)");isNaN(e)?(n.addClass("default"),n.find(".igr-value").text("- -")):(n.addClass(window.ut.utils.getStatColorClass(e)),n.find(".igr-value").text(e))})})}}var i=function(t,e){return r.generate({bindto:t,data:{columns:[["data",e]],type:"gauge"},interaction:{enabled:!1},gauge:{label:{format:function(t,e){return t},show:!1},max:99,width:6},color:{pattern:["#dd504c","#e29e2d","#f0c73f","#419b3c","#42c639"],threshold:{values:[60,70,80,90,100]}},size:{height:50}})},o={$:t(".player-cards .playercard:first"),$chemIcon:null,$attr1:null,$attr2:null,$attr3:null,$attr4:null,$attr5:null,$attr6:null,current:{attr1:null,attr2:null,attr3:null,attr4:null,attr5:null,attr6:null},init:function(){var t=this;this.$chemIcon=this.$.find(".playercard-chem.playercard-chembot > span:first"),[1,2,3,4,5,6].forEach(function(r){var n=t.$.find(".playercard-attr.playercard-attr"+r);e.set(t,"$attr"+r,n),e.set(t.current,"attr"+r,parseInt(n.find(".chembot-value").text(),10))})},editAttr:function(t,r){var a=arguments.length>2&&arguments[2]!==n&&arguments[2],i=e.get(this,"$"+t),o=i.find(".chembot-value"),s=i.find(".chembot-delta"),c=parseInt(s.data("chembot-base"));if(!0===a)return o.text(c),s.text("").removeClass("up down"),void(this.current[t]=c);var l=void 0;r?l=r-c:(l=0,r=c);var d=void 0;d=l>0?"up":l<0?"down":"",o.text(r),s.text(l||"").removeClass("up down").addClass(d),this.current[t]=r},editChemIcon:function(t){this.$chemIcon.removeClass().addClass(t)},reset:function(){var t=this;this.editChemIcon(""),[1,2,3,4,5,6].forEach(function(e){t.editAttr("attr"+e,null,!0)})}},s={$:t(".player-stats-igs"),attrCharts:null,igsToPrimary:null,init:function(t){var r=this;this.attrCharts=t,window.ut.player.getIgsWeights("GK"===window.fhContext.player.position).then(function(t){r.igsToPrimary=e.reduce(t,function(t,r,n){return e.keys(r).forEach(function(e){t[e]=n}),t},{})})},applyChemistryStyle:function(t){var r=this,i=arguments.length>1&&arguments[1]!==n?arguments[1]:100,s=arguments.length>2&&arguments[2]!==n?arguments[2]:10;null!=c.current&&(this.reset(),o.reset()),null!=t&&(window.history.replaceState(window.state,document.title,preserve(window.location.href,"chemType",t.name)),window.history.replaceState(window.state,document.title,preserve(window.location.href,"teamChem",i)),window.history.replaceState(window.state,document.title,preserve(window.location.href,"individualChem",s)),window.ut.utils.applyChemistryStyle(t,window.fhContext.player,i,s).then(function(t){var n=e(t.chemistryChanges).pickBy(function(t){return 0!==t.delta}).value(),i=[];e.map(n,function(e,n){r.updateIgs(_extends({},e,{name:n}));var a=r.igsToPrimary[n];i.includes(a)||(o.editAttr(a,t[a]),i.push(a))}),r.updateAttrCharts(t),a()}))},updateIgs:function(t){var e=t.name,r=t.delta,n=t.final,a=this.$.find('[data-chembot-field="'+e.toLowerCase()+'"]');a.text((r>-1?"+":"-")+r).css("color",r>0?"rgb(58, 174, 0)":"rgb(218, 2, 0)").show(),a.prev().text(n).removeClassByPattern("stat-color-\\d").addClass(window.ut.utils.getStatColorClass(n))},updateAttrCharts:function(r){var n=this,a=r.attr1,i=r.attr2,o=r.attr3,s=r.attr4,c=r.attr5,l=r.attr6;e.each({attr1:a,attr2:i,attr3:o,attr4:s,attr5:c,attr6:l},function(e,r){!r in n.attrCharts||window.fhContext.player[r]===e||(n.attrCharts[r].load({columns:[["data",e]]}),t(n.attrCharts[r].element).removeClassByPattern("stat-color-\\d").addClass(window.ut.utils.getStatColorClass(e)))})},reset:function(){var r=this;window.history.replaceState(window.state,document.title,window.location.origin+window.location.pathname),r.$.find("[data-chembot-field]").each(function(){var n=t(this),a=n.data("chembot-base"),i=n.data("chembot-field");if(n.hide(),i in r.attrCharts){if(e.get(r.attrCharts[i].data(),"[0].values[0].value",0)===a)return;n.siblings(".stat-chart").removeClassByPattern("(default|stat-color-\\d)").addClass(window.ut.utils.getStatColorClass(a)),r.attrCharts[i].load({columns:[["data",a]]})}else{var o=n.siblings(".chembot-value");if(parseInt(o.text())===a)return;o.text(a).removeClassByPattern("stat-color-\\d").addClass(window.ut.utils.getStatColorClass(a))}}),a()}},c={$:t(".chemistry-selector-widget"),$icon:t("#chemistry-selector .icon-container span"),$name:t("#chemistry-selector .chemistry-name"),$resetButton:t(".player-chemistry-remove-style"),available:[],current:null,init:function(r,n){var a=this,i=this;return e.get(n,"current",!1)&&(this.current=n.current),i.$.find("#chemistry-selector").click(function(){a.toggleDrawer()}),i.$.find(".chemistry-options .chemistry-option").click(function(){var r=e.find(i.available,{for_gk:"GK"===window.fhContext.player.position,name:t(this).data("chem-type")});if(null==r)return i.reset(),void console.warn('Could not find chemistry style for "'+t(this).data("chem-type")+'" from the available chemistry styles.',i.available);i.current&&r.name===i.current.name?i.reset():i.setStyle(r)}),i.$.find(".chemistry-options-close").click(function(){return i.closeDrawer()}),i.$resetButton.click(function(){i.closeDrawer(),i.reset()}),i._populateStyles(r)},_populateStyles:function(t){var e=this;return window.ut.utils.getChemistryStylesForYear(t).then(function(t){return e.available=t})},openDrawer:function(){this.$.addClass("open")},closeDrawer:function(){this.$.removeClass("open")},toggleDrawer:function(){this.$.toggleClass("open")},setStyle:function(t){null!=t?(this.current=t,this.$.find("a.chemistry-option").removeClass("active"),this.$.find('a.chemistry-option[data-chem-type="'+t.name+'"]').addClass("active"),this.$icon.removeClass().addClass(t.icon_class),this.$name.text(t.name),this.$resetButton.show(),s.applyChemistryStyle(t,l.current,d.current),o.editChemIcon(t.icon_class)):this.reset()},reset:function(){this.current=null,this.$.find("a.chemistry-option").removeClass("active"),this.$resetButton.hide(),s.reset(),o.reset()}},l={$:t("#team-chem"),$input:t("#team-chem-value"),current:100,init:function(t){var r=this;e.get(t,"current",!1)&&(this.current=t.current),r.$.slider({max:100,value:r.current,slide:function(t,e){r.$input.val(e.value)},stop:function(t,e){r.current=e.value,s.applyChemistryStyle(c.current,r.current,d.current)}}),r.$input.val(r.current),r.$input.change(function(){var t=parseInt(r.$input.val());isNaN(t)||(r.$.slider("value",t),r.current=t,s.applyChemistryStyle(c.current,r.current,d.current))})}},d={$:t("#individual-chem"),$input:t("#individual-chem-value"),current:10,init:function(t){var r=this;e.get(t,"current",!1)&&(this.current=t.current),r.$.slider({max:10,value:r.current,slide:function(t,e){r.$input.val(e.value)},stop:function(t,e){r.current=e.value,s.applyChemistryStyle(c.current,l.current,r.current)}}),r.$input.val(r.current),r.$input.change(function(){var t=parseInt(r.$input.val());isNaN(t)||(r.$.slider("value",t),r.current=t,s.applyChemistryStyle(c.current,l.current,r.current))})}},u=function(){return{attr1:i("#attr1-chart",window.fhContext.attr1),attr2:i("#attr2-chart",window.fhContext.attr2),attr3:i("#attr3-chart",window.fhContext.attr3),attr4:i("#attr4-chart",window.fhContext.attr4),attr5:i("#attr5-chart",window.fhContext.attr5),attr6:i("#attr6-chart",window.fhContext.attr6)}},h=function(){return{attacker:i("#attacker-chart",window.fhContext.attacker_rating),creator:i("#creator-chart",window.fhContext.creator_rating),defender:i("#defender-chart",window.fhContext.defender_rating),beast:i("#beast-chart",window.fhContext.beast_rating),heading:i("#heading-chart",window.fhContext.heading_rating)}};t().ready(function(){var r=function(e,r){t.ajax({method:"get",url:"/prices/api/",data:{year:e,id:r}}).done(function(e){if(e&&e[r]){var n=e[r];t.each(["ps","xb","pc"],function(){if(n[this]){var e=t(".player-info-price-bin-"+this);e.find(".player-info-price-lowest-bin .value").text(n[this].toLocaleString());var r=e.find(".player-info-price-bin-updated");r.find(".prefix").text("Last Updated"),r.find(".update-time").data("time",n[this+"Time"]/1e3).smartTime(timeAgo,1e3);var a=e.find(".player-info-price-more-bins");t.each(n[this+"LowFive"].slice(1),function(t,e){a.find("div:nth-child("+(t+1)+") .value").text(e.toLocaleString())})}})}})};window.fhContext.defId!==n&&null!==window.fhContext.defId&&(r(window.fhContext.year,window.fhContext.defId),18===window.fhContext.year&&setInterval(function(){r(window.fhContext.year,window.fhContext.defId)},6e4)),o.init();var i=u(),f=t(".player-chemistry").data();f&&f.enabled&&(c.init(window.fhContext.year).then(function(){if(f.chemType){var t=e.find(c.available,{name:f.chemType,for_gk:"GK"===window.fhContext.player.position});c.setStyle(t)}}),s.init(i),l.init({current:f.teamChem}),d.init({current:f.indvChem})),a(),window.fhContext.hasIgs&&h();var p=t("#share_modal_player_data"),w=function(e){t("#download-modal").scrollTop(0),html2canvas(e,{proxy:"/card-generator/proxy/",background:n,onrendered:function(e){var r=document.createElement("a");r.style.display="none",r.href=e.toDataURL("image/png"),r.download=p.data("player-full-name")+" ("+p.data("player-revision-type")+").png",document.body.appendChild(r),r.click(),t(r)}})};t(".download-sd").click(function(){t(".render-card-sd").show(),t(".render-card-hd").hide(),w(t(".render-card-sd .playercard.card-large:first")[0])}),t(".download-hd").click(function(){t(".render-card-hd").show(),t(".render-card-sd").hide(),w(t(".render-card-hd .playercard.card-hd:first")[0])}),t("#rendering-class-toggle").change(function(){var e;e=t(this).prop("checked")?"removeClass":"addClass",t(this).closest(".modal").find(".playercard")[e]("rendering")})})}(jQuery,_,c3);