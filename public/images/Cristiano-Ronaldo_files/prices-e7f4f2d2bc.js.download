"use strict";!function(){function e(e,t,n){var r=1-t/n,i=d3.select("defs").append("linearGradient").attr("id",e).attr("x1","0%").attr("y1","0%").attr("x2","0%").attr("y2",100*r+"%");i.append("stop").attr("offset","15%").attr("stop-color","#404048").attr("stop-opacity","0.9"),i.append("stop").attr("offset","90%").attr("stop-color","#404048").attr("stop-opacity","0")}function t(){$(".c3-lines-price").before($(".c3-areas-price"))}function n(e){for(var t,n=Math.max.apply(null,e),r=n-Math.min.apply(null,e),i=0;i<d.length;i++)if(r<=d[i].range){t=d[i].increment;break}for(var a,o=d.length;o>0;o--)if(n>=d[o-1].min){a=d[o-1].increment;break}return Math.max(t,a)}function r(e,t){for(var n=Math.max.apply(null,e),r=Math.min.apply(null,e),i=Math.floor(r/t)*t,a=[];i<n+t;)a.push(i),i+=t;var o=t/2;for(r-a[0]>=o&&a.splice(0,1),a.length>1&&a[a.length-1]-n>=o&&a.splice(-1,1);a.length<3&&a[0]>0;)a.splice(0,0,a[0]-t);return a}function i(e,t){isNaN(t)&&(t=0);var n=Math.max.apply(null,e),r=Math.min.apply(null,e),i=(n-r)*t;return{max:n+i,min:r-i}}function a(a,o,c){var s,l,u,p=[];if($.isEmptyObject(a)||$.isEmptyObject(a[o]))$(".player-info-history").addClass("unavailable");else{$(".player-info-history").removeClass("unavailable"),p=[["price"].concat(a[o]),["time"].concat(a.time)],l=r(s=a[o],n(s)),u=i(s.concat(l));var m;m="hourly"===c||"daily"===c?h.axis.dateHHMM:h.axis.datePerDay,c3.generate({bindto:"#player-prices",area:{zerobased:!1},axis:{x:{localtime:!0,type:"timeseries",tick:{centered:!0,culling:!0,format:m}},y:{show:!0,label:{text:"AVERAGE PRICE",position:"outer-middle"},tick:{outer:!0,values:l,format:h.axis.price},max:u.max,min:u.min}},data:{axes:{price:"y"},classes:{price:o},columns:p,color:function(){switch(o){case"pc":return"#f45809";case"ps":return"#4170cb";case"xb":return"#3aae00"}},type:"area",x:"time"},grid:{y:{show:!0}},legend:{hide:!0},padding:{top:-4,bottom:-10,left:55},point:{r:1,focus:{expand:{r:6.5}}},tooltip:{contents:function(e){return'                        <div class="price-history-tooltip">                            <div class="price-history-tooltip-title">                                '+h.tooltip.title(e[0].x,"hourly"===c||"daily"===c)+'                            </div>                            <div class="price-history-tooltip-value">                                <img src="'+cdnify("img/coins.png")+'">                                '+h.tooltip.value(e[0].value)+"                            </div>                        </div>"}},transition:{duration:200}}),e("gradient",u.min,u.max),t()}}function o(e){return JSON.stringify(e)}function c(e){return void 0!==s(e)}function s(e){return m[o(e)]}function l(e,t){m[o(e)]=t}function u(e){var t=$("#player-prices").data();void 0===e&&(e=p||t.defaultScope),p=e;var n=$.cookie("futhead-settings-price-platform")||t.defaultPlatform,r={id:t.id,scope:e,year:window.fhContext.year,platform:n};c(r)?a(s(r),n,e):$.ajax({method:"GET",url:"/prices/api/history/",data:r}).done(function(i){l(r,i[t.id]),a(i[t.id],n,e)})}var p,m={},d=[{min:0,range:1e3,increment:100},{min:5e3,range:2500,increment:250},{min:1e4,range:5e3,increment:500},{min:2e4,range:1e4,increment:1e3},{min:5e4,range:25e3,increment:2500},{min:1e5,range:5e4,increment:5e3},{min:2e5,range:1e5,increment:1e4},{min:5e5,range:25e4,increment:25e3},{min:1e6,range:5e5,increment:5e4},{min:2e6,range:1e6,increment:1e5},{min:5e6,range:25e5,increment:25e4},{min:1e6,range:5e6,increment:5e5},{min:Number.MAX_VALUE,range:Number.MAX_VALUE,increment:1e6}],f=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],y=["January","February","March","April","May","June","July","August","September","October","November","December"],g=["","K","M","B","T"],h={axis:{dateHHMM:function(e){return("0"+e.getHours()).slice(-2)+":"+("0"+e.getMinutes()).slice(-2)},datePerDay:function(e){return y[e.getMonth()].substr(0,3)+" "+e.getDate()},price:function(e){if(isNaN(e)||e<1e4)return e;for(var t=0;e>=1e3;)t+=1,e/=1e3;return Math.round(100*e)/100+g[t]}},tooltip:{title:function(e,t){return!0===t?y[e.getMonth()].substr(0,3)+" "+e.getDate()+", "+("0"+e.getHours()).slice(-2)+":"+("0"+e.getMinutes()).slice(-2):f[e.getDay()]+", "+y[e.getMonth()].substr(0,3)+" "+e.getDate()+", "+e.getFullYear()},value:function(e){return e.toLocaleString()}}};$().ready(function(){$("#player-prices").length>0&&(u(),$(".price-history-scope").click(function(){$(this).addClass("selected").siblings().removeClass("selected"),u($(this).data("scope"))}),$(".price-platform").click(function(){u()}))})}();